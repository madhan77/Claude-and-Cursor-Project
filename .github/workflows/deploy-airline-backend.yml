name: Deploy Airline Backend to Render

on:
  push:
    branches:
      - main
    paths:
      - 'airline-reservation-system/backend/**'
      - '.github/workflows/deploy-airline-backend.yml'

jobs:
  deploy:
    name: Trigger Render Deployment
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Trigger Render Deploy Hook
        env:
          RENDER_DEPLOY_HOOK_URL: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        run: |
          echo "ðŸš€ Triggering Render deployment..."

          if [ -z "$RENDER_DEPLOY_HOOK_URL" ]; then
            echo "âŒ ERROR: RENDER_DEPLOY_HOOK_URL secret not set!"
            echo "Please add the deploy hook URL to GitHub Secrets"
            exit 1
          fi

          # Trigger the deploy hook
          response=$(curl -s -o /dev/null -w "%{http_code}" -X POST "$RENDER_DEPLOY_HOOK_URL")

          if [ "$response" -eq 200 ] || [ "$response" -eq 201 ]; then
            echo "âœ… Deployment triggered successfully!"
            echo "ðŸ“Š Response code: $response"
            echo "â³ Render is now building and deploying your application..."
            echo "ðŸ”— Check status at: https://dashboard.render.com/"
          else
            echo "âŒ Deployment trigger failed!"
            echo "ðŸ“Š Response code: $response"
            exit 1
          fi

      - name: Deployment Summary
        run: |
          echo "## ðŸš€ Deployment Triggered" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Render deployment has been triggered successfully!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### What's happening now:" >> $GITHUB_STEP_SUMMARY
          echo "1. â³ Render is pulling the latest code from GitHub" >> $GITHUB_STEP_SUMMARY
          echo "2. â³ Installing dependencies (npm install)" >> $GITHUB_STEP_SUMMARY
          echo "3. â³ Building the application (npm run build)" >> $GITHUB_STEP_SUMMARY
          echo "4. â³ Deploying to production" >> $GITHUB_STEP_SUMMARY
          echo "5. â³ Running health checks" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Expected completion time:** ~5-7 minutes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— [Monitor deployment on Render Dashboard](https://dashboard.render.com/)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Backend URL: https://airline-backend-nlsk.onrender.com" >> $GITHUB_STEP_SUMMARY
